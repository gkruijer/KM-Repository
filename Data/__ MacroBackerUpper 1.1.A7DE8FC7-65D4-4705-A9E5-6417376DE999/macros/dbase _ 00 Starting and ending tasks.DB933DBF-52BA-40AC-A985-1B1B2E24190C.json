{
	"UID": "DB933DBF-52BA-40AC-A985-1B1B2E24190C",
	"CreationDate": 721235948.185957,
	"ModificationDate": 720843757.665869,
	"Triggers": [],
	"Actions": [
		{
			"MacroActionType": "Comment",
			"Title": "dbase: Starting and ending tasks",
			"StyledText": "\n\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\tcnRmZAAAAAADAAAAAgAA\n\t\t\t\t\t\t\tAAcAAABUWFQucnRmAQAA\n\t\t\t\t\t\t\tAC48AgAAKwAAAAEAAAA0\n\t\t\t\t\t\t\tAgAAe1xydGYxXGFuc2lc\n\t\t\t\t\t\t\tYW5zaWNwZzEyNTJcY29j\n\t\t\t\t\t\t\tb2FydGYyNzA5Clxjb2Nv\n\t\t\t\t\t\t\tYXRleHRzY2FsaW5nMFxj\n\t\t\t\t\t\t\tb2NvYXBsYXRmb3JtMHtc\n\t\t\t\t\t\t\tZm9udHRibFxmMFxmc3dp\n\t\t\t\t\t\t\tc3NcZmNoYXJzZXQwIEhl\n\t\t\t\t\t\t\tbHZldGljYS1Cb2xkO1xm\n\t\t\t\t\t\t\tMVxmc3dpc3NcZmNoYXJz\n\t\t\t\t\t\t\tZXQwIEhlbHZldGljYTt9\n\t\t\t\t\t\t\tCntcY29sb3J0Ymw7XHJl\n\t\t\t\t\t\t\tZDI1NVxncmVlbjI1NVxi\n\t\t\t\t\t\t\tbHVlMjU1O1xyZWQwXGdy\n\t\t\t\t\t\t\tZWVuMFxibHVlMDt9Cntc\n\t\t\t\t\t\t\tKlxleHBhbmRlZGNvbG9y\n\t\t\t\t\t\t\tdGJsOztcY3NzcmdiXGMw\n\t\t\t\t\t\t\tXGMwXGMwXGM4NDcwNlxj\n\t\t\t\t\t\t\tbmFtZSBjb250cm9sVGV4\n\t\t\t\t\t\t\tdENvbG9yO30KXHBhcmRc\n\t\t\t\t\t\t\tdHg1NjBcdHgxMTIwXHR4\n\t\t\t\t\t\t\tMTY4MFx0eDIyNDBcdHgy\n\t\t\t\t\t\t\tODAwXHR4MzM2MFx0eDM5\n\t\t\t\t\t\t\tMjBcdHg0NDgwXHR4NTA0\n\t\t\t\t\t\t\tMFx0eDU2MDBcdHg2MTYw\n\t\t\t\t\t\t\tXHR4NjcyMFxwYXJkaXJu\n\t\t\t\t\t\t\tYXR1cmFsXHBhcnRpZ2h0\n\t\t\t\t\t\t\tZW5mYWN0b3IwCgpcZjBc\n\t\t\t\t\t\t\tYlxmczI2IFxjZjIgUHVy\n\t\t\t\t\t\t\tcG9zZQpcZjFcYjAgXAog\n\t\t\t\t\t\t\tIFwnOTUgQXQgc3RhcnQg\n\t\t\t\t\t\t\tb2YgYmFja3VwLCBhZGRz\n\t\t\t\t\t\t\tICJuZXcgYmFja3VwIiB0\n\t\t\t\t\t\t\tYWJsZXMgdG8gZGF0YWJh\n\t\t\t\t\t\t\tc2UuIEF0IGVuZCBvZiBi\n\t\t\t\t\t\t\tYWNrdXAsIG1vdmVzICJu\n\t\t\t\t\t\t\tZXcgYmFja3VwIiB0YWJs\n\t\t\t\t\t\t\tZXMgdG8gIm9sZCBiYWNr\n\t\t\t\t\t\t\tdXAiIHRhYmxlcy59AQAA\n\t\t\t\t\t\t\tACMAAAABAAAABwAAAFRY\n\t\t\t\t\t\t\tVC5ydGYQAAAAAKRGZbYB\n\t\t\t\t\t\t\tAAAAAAAAAAAAAA==\n\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t",
			"ActionColor": "Teal",
			"ActionUID": 15363743
		},
		{
			"MacroActionType": "Switch",
			"ActionName": "Case Statement",
			"CaseEntries": [
				{
					"Actions": [
						{
							"MacroActionType": "Comment",
							"Title": "Generic comment with Helvetica text",
							"ActionName": "Database prep at start of backup process",
							"ActionUID": 15363745,
							"IsDisclosed": false,
							"ActionColor": "Yellow",
							"StyledText": "\n\t\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t\tcnRmZAAAAAAD\n\t\t\t\t\t\t\t\tAAAAAgAAAAcA\n\t\t\t\t\t\t\t\tAABUWFQucnRm\n\t\t\t\t\t\t\t\tAQAAAC5wAQAA\n\t\t\t\t\t\t\t\tKwAAAAEAAABo\n\t\t\t\t\t\t\t\tAQAAe1xydGYx\n\t\t\t\t\t\t\t\tXGFuc2lcYW5z\n\t\t\t\t\t\t\t\taWNwZzEyNTJc\n\t\t\t\t\t\t\t\tY29jb2FydGYx\n\t\t\t\t\t\t\t\tNjcxXGNvY29h\n\t\t\t\t\t\t\t\tc3VicnRmNjAw\n\t\t\t\t\t\t\t\tCntcZm9udHRi\n\t\t\t\t\t\t\t\tbFxmMFxmc3dp\n\t\t\t\t\t\t\t\tc3NcZmNoYXJz\n\t\t\t\t\t\t\t\tZXQwIEhlbHZl\n\t\t\t\t\t\t\t\tdGljYTt9Cntc\n\t\t\t\t\t\t\t\tY29sb3J0Ymw7\n\t\t\t\t\t\t\t\tXHJlZDI1NVxn\n\t\t\t\t\t\t\t\tcmVlbjI1NVxi\n\t\t\t\t\t\t\t\tbHVlMjU1O1xy\n\t\t\t\t\t\t\t\tZWQwXGdyZWVu\n\t\t\t\t\t\t\t\tMFxibHVlMDt9\n\t\t\t\t\t\t\t\tCntcKlxleHBh\n\t\t\t\t\t\t\t\tbmRlZGNvbG9y\n\t\t\t\t\t\t\t\tdGJsOztcY3Nz\n\t\t\t\t\t\t\t\tcmdiXGMwXGMw\n\t\t\t\t\t\t\t\tXGMwXGM4NDcw\n\t\t\t\t\t\t\t\tNlxjbmFtZSBj\n\t\t\t\t\t\t\t\tb250cm9sVGV4\n\t\t\t\t\t\t\t\tdENvbG9yO30K\n\t\t\t\t\t\t\t\tXHBhcmRcdHg1\n\t\t\t\t\t\t\t\tNjBcdHgxMTIw\n\t\t\t\t\t\t\t\tXHR4MTY4MFx0\n\t\t\t\t\t\t\t\teDIyNDBcdHgy\n\t\t\t\t\t\t\t\tODAwXHR4MzM2\n\t\t\t\t\t\t\t\tMFx0eDM5MjBc\n\t\t\t\t\t\t\t\tdHg0NDgwXHR4\n\t\t\t\t\t\t\t\tNTA0MFx0eDU2\n\t\t\t\t\t\t\t\tMDBcdHg2MTYw\n\t\t\t\t\t\t\t\tXHR4NjcyMFxw\n\t\t\t\t\t\t\t\tYXJkaXJuYXR1\n\t\t\t\t\t\t\t\tcmFsXHBhcnRp\n\t\t\t\t\t\t\t\tZ2h0ZW5mYWN0\n\t\t\t\t\t\t\t\tb3IwCgpcZjBc\n\t\t\t\t\t\t\t\tZnMyNiBcY2Yy\n\t\t\t\t\t\t\t\tIC59AQAAACMA\n\t\t\t\t\t\t\t\tAAABAAAABwAA\n\t\t\t\t\t\t\t\tAFRYVC5ydGYQ\n\t\t\t\t\t\t\t\tAAAAoGXMYbYB\n\t\t\t\t\t\t\t\tAAAAAAAAAAAA\n\t\t\t\t\t\t\t\tAA==\n\t\t\t\t\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t\t"
						},
						{
							"MacroActionType": "ExecuteShellScript",
							"ActionName": "Get count of folders in backup folder",
							"IncludedVariables": [
								"9999"
							],
							"TrimResults": true,
							"Source": "Nothing",
							"Variable": "local_PreBackupCount",
							"IncludeStdErr": false,
							"ActionUID": 15363746,
							"UseText": true,
							"TrimResultsNew": true,
							"TimeOutAbortsMacro": true,
							"Path": "",
							"DisplayKind": "Variable",
							"IsDisclosed": false,
							"HonourFailureSettings": true,
							"Text": "find \"$KMVAR_rg_MBU_BackupLoc\" -name \"2*\" -maxdepth 1 | wc -l"
						},
						{
							"MacroActionType": "Group",
							"ActionName": "Check database status, recreate if necessary",
							"Actions": [
								{
									"MacroActionType": "Switch",
									"ActionName": "If first backup, there shouldn't be a database, so delete it if found",
									"CaseEntries": [
										{
											"Actions": [
												{
													"MacroActionType": "ExecuteShellScript",
													"ActionName": "Delete database if it's there, as it can't be correct",
													"IncludedVariables": [
														"9999"
													],
													"TrimResults": true,
													"Source": "Nothing",
													"IncludeStdErr": false,
													"ActionUID": 15363749,
													"UseText": true,
													"TrimResultsNew": true,
													"TimeOutAbortsMacro": true,
													"Path": "",
													"DisplayKind": "None",
													"IsDisclosed": false,
													"HonourFailureSettings": true,
													"Text": "if [ -d \"$KMVAR_instance_theDatabasePath\" ]; then rm \"$KMVAR_instance_theDatabasePath\"; fi "
												}
											],
											"ConditionType": "Is",
											"TestValue": "0"
										},
										{
											"Actions": [
												{
													"MacroActionType": "Comment",
													"Title": "",
													"ActionName": "With at least one backup, there should be a database.",
													"ActionUID": 15363750,
													"IsDisclosed": false,
													"ActionColor": "Yellow",
													"StyledText": "\n\t\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t\tcnRmZAAAAAAD\n\t\t\t\t\t\t\t\tAAAAAgAAAAcA\n\t\t\t\t\t\t\t\tAABUWFQucnRm\n\t\t\t\t\t\t\t\tAQAAAC5wAQAA\n\t\t\t\t\t\t\t\tKwAAAAEAAABo\n\t\t\t\t\t\t\t\tAQAAe1xydGYx\n\t\t\t\t\t\t\t\tXGFuc2lcYW5z\n\t\t\t\t\t\t\t\taWNwZzEyNTJc\n\t\t\t\t\t\t\t\tY29jb2FydGYx\n\t\t\t\t\t\t\t\tNjcxXGNvY29h\n\t\t\t\t\t\t\t\tc3VicnRmNjAw\n\t\t\t\t\t\t\t\tCntcZm9udHRi\n\t\t\t\t\t\t\t\tbFxmMFxmc3dp\n\t\t\t\t\t\t\t\tc3NcZmNoYXJz\n\t\t\t\t\t\t\t\tZXQwIEhlbHZl\n\t\t\t\t\t\t\t\tdGljYTt9Cntc\n\t\t\t\t\t\t\t\tY29sb3J0Ymw7\n\t\t\t\t\t\t\t\tXHJlZDI1NVxn\n\t\t\t\t\t\t\t\tcmVlbjI1NVxi\n\t\t\t\t\t\t\t\tbHVlMjU1O1xy\n\t\t\t\t\t\t\t\tZWQwXGdyZWVu\n\t\t\t\t\t\t\t\tMFxibHVlMDt9\n\t\t\t\t\t\t\t\tCntcKlxleHBh\n\t\t\t\t\t\t\t\tbmRlZGNvbG9y\n\t\t\t\t\t\t\t\tdGJsOztcY3Nz\n\t\t\t\t\t\t\t\tcmdiXGMwXGMw\n\t\t\t\t\t\t\t\tXGMwXGM4NDcw\n\t\t\t\t\t\t\t\tNlxjbmFtZSBj\n\t\t\t\t\t\t\t\tb250cm9sVGV4\n\t\t\t\t\t\t\t\tdENvbG9yO30K\n\t\t\t\t\t\t\t\tXHBhcmRcdHg1\n\t\t\t\t\t\t\t\tNjBcdHgxMTIw\n\t\t\t\t\t\t\t\tXHR4MTY4MFx0\n\t\t\t\t\t\t\t\teDIyNDBcdHgy\n\t\t\t\t\t\t\t\tODAwXHR4MzM2\n\t\t\t\t\t\t\t\tMFx0eDM5MjBc\n\t\t\t\t\t\t\t\tdHg0NDgwXHR4\n\t\t\t\t\t\t\t\tNTA0MFx0eDU2\n\t\t\t\t\t\t\t\tMDBcdHg2MTYw\n\t\t\t\t\t\t\t\tXHR4NjcyMFxw\n\t\t\t\t\t\t\t\tYXJkaXJuYXR1\n\t\t\t\t\t\t\t\tcmFsXHBhcnRp\n\t\t\t\t\t\t\t\tZ2h0ZW5mYWN0\n\t\t\t\t\t\t\t\tb3IwCgpcZjBc\n\t\t\t\t\t\t\t\tZnMyNiBcY2Yy\n\t\t\t\t\t\t\t\tIC59AQAAACMA\n\t\t\t\t\t\t\t\tAAABAAAABwAA\n\t\t\t\t\t\t\t\tAFRYVC5ydGYQ\n\t\t\t\t\t\t\t\tAAAAoGXMYbYB\n\t\t\t\t\t\t\t\tAAAAAAAAAAAA\n\t\t\t\t\t\t\t\tAA==\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t\t"
												},
												{
													"MacroActionType": "ExecuteShellScript",
													"ActionName": "Check if database present, recreate old data if not",
													"IncludedVariables": [
														"9999"
													],
													"TrimResults": true,
													"Source": "Nothing",
													"Variable": "local_DbaseCheck",
													"IncludeStdErr": false,
													"ActionUID": 15363751,
													"UseText": true,
													"TrimResultsNew": true,
													"TimeOutAbortsMacro": true,
													"Path": "",
													"DisplayKind": "Variable",
													"HonourFailureSettings": true,
													"Text": "if [ ! -f \"$KMVAR_instance_theDatabasePath\" ]; then echo \"dbase missing\"; fi"
												},
												{
													"MacroActionType": "SetNextEngineWindow",
													"Action": "CenterWindow",
													"ActionUID": 15363752,
													"IsDisclosed": false,
													"HorizontalExpression": "125",
													"WidthExpression": "300",
													"VerticalExpression": "125",
													"HeightExpression": "300"
												},
												{
													"MacroActionType": "Switch",
													"ActionName": "Case Statement",
													"CaseEntries": [
														{
															"Actions": [
																{
																	"MacroActionType": "PromptForUserInput",
																	"Title": "The database file is missing",
																	"Prompt": "You have more than one backup, but the database file can't be found. Click OK and it will be recreated.",
																	"ActionUID": 15363754,
																	"TimeOutAbortsMacro": true,
																	"IsActive": false,
																	"Buttons": [
																		{
																			"Button": "OK"
																		}
																	],
																	"Variables": []
																},
																{
																	"MacroActionType": "Notification",
																	"Title": "The database couldn't be found; it",
																	"SoundName": "",
																	"Subtitle": "has been successfully rebuilt",
																	"Text": "Please don't delete it :)",
																	"ActionUID": 15363755
																},
																{
																	"MacroActionType": "ExecuteShellScript",
																	"ActionName": "Get the newest folder",
																	"IncludedVariables": [
																		"9999"
																	],
																	"TrimResults": true,
																	"Source": "Nothing",
																	"Variable": "local_lastBackup",
																	"IncludeStdErr": false,
																	"ActionUID": 15363756,
																	"UseText": true,
																	"TrimResultsNew": true,
																	"TimeOutAbortsMacro": true,
																	"Path": "",
																	"DisplayKind": "Variable",
																	"HonourFailureSettings": true,
																	"Text": "find \"$KMVAR_rg_MBU_BackupLoc\" -maxdepth 1 -name \"2*\" | sort -r | head -1"
																},
																{
																	"MacroActionType": "Group",
																	"ActionName": "Create SQL for all groups",
																	"Actions": [
																		{
																			"MacroActionType": "ReadFile",
																			"Source": "%Variable%local_lastBackup%/.UUID_AllGroups",
																			"Variable": "local_old_UUID_groups",
																			"Destination": "Variable",
																			"ActionUID": 15363758
																		},
																		{
																			"MacroActionType": "SearchReplace",
																			"ActionName": "Quote the single apostrophe for import",
																			"Search": "'",
																			"Source": "Variable",
																			"Action": "IgnoreCaseRegEx",
																			"ActionUID": 15363759,
																			"Variable": "local_old_UUID_groups",
																			"Which": "All",
																			"Replace": "''"
																		},
																		{
																			"MacroActionType": "SearchReplace",
																			"ActionName": "Convert delimted text into SQL command",
																			"Action": "IgnoreCaseRegEx",
																			"ActionUID": 15363760,
																			"Destination": "Variable",
																			"Search": "(?m)^(.*?)###(.*?)$",
																			"Source": "Variable",
																			"Variable": "local_old_UUID_groups",
																			"Which": "All",
																			"Replace": "insert into groups_old (\"Group_ID\",\"Group_Mod\",\"Group_Name\",\"Group_Status\") values ('$1','No','$2','');",
																			"DestinationVariable": "local_OldGroupSQL"
																		}
																	],
																	"TimeOutAbortsMacro": true,
																	"ActionUID": 15363757
																},
																{
																	"MacroActionType": "Group",
																	"ActionName": "Create SQL for all macros",
																	"Actions": [
																		{
																			"MacroActionType": "ReadFile",
																			"Source": "%Variable%local_lastBackup%/.UUID_AllMacros",
																			"Variable": "local_old_UUID_macros",
																			"Destination": "Variable",
																			"ActionUID": 15363762
																		},
																		{
																			"MacroActionType": "SearchReplace",
																			"ActionName": "Quote the single apostrophe for import",
																			"Search": "'",
																			"Source": "Variable",
																			"Action": "IgnoreCaseRegEx",
																			"ActionUID": 15363763,
																			"Variable": "local_old_UUID_macros",
																			"Which": "All",
																			"Replace": "''"
																		},
																		{
																			"MacroActionType": "SearchReplace",
																			"ActionName": "Search/Replace: regex",
																			"Action": "IgnoreCaseRegEx",
																			"ActionUID": 15363764,
																			"Destination": "Variable",
																			"Search": "(?m)^(.*?)###(.*?)###(.*)$",
																			"Source": "Variable",
																			"Variable": "local_old_UUID_macros",
																			"Which": "All",
																			"Replace": "insert into macros_old_temp (\"Group_ID\",\"Macro_ID\",\"Macro_Name\",\"Macro_Mod\",\"Macro_Status\") values ('$1','$2','$3','No','');",
																			"DestinationVariable": "local_OldMacrosSQL"
																		}
																	],
																	"TimeOutAbortsMacro": true,
																	"ActionUID": 15363761
																},
																{
																	"MacroActionType": "SetVariableToText",
																	"ActionName": "Create tables and import newest backup's data",
																	"Variable": "instanceTheData",
																	"Text": "CREATE TABLE IF NOT EXISTS \"macros_old_temp\" (\n\"Group_ID\" TEXT,\n\"Macro_ID\" TEXT PRIMARY KEY,\n\"Macro_Mod\" TEXT,\n\"Macro_Name\" TEXT,\n\"Macro_Status\" TEXT\n);\n\nCREATE TABLE IF NOT EXISTS \"groups_old\" (\n\"Group_ID\" TEXT PRIMARY KEY,\n\"Group_Mod\" TEXT,\n\"Group_Name\" TEXT,\n\"Group_Status\" TEXT\n);\n\n%Variable%local_OldGroupSQL%\n%Variable%local_OldMacrosSQL%",
																	"ActionUID": 15363765
																},
																{
																	"MacroActionType": "WriteFile",
																	"Append": false,
																	"Format2": "PlainText",
																	"Format": "PlainText",
																	"Destination": "/tmp/MBU_rgdata.sql",
																	"Encoding": "UTF8",
																	"ActionUID": 15363766,
																	"Source": "Variable",
																	"Variable": "instanceTheData"
																},
																{
																	"MacroActionType": "ExecuteShellScript",
																	"ActionName": "Create/update the database",
																	"IncludedVariables": [
																		"9999"
																	],
																	"TrimResults": true,
																	"StopOnFailure": false,
																	"Source": "Nothing",
																	"IncludeStdErr": false,
																	"ActionUID": 15363767,
																	"UseText": true,
																	"TrimResultsNew": true,
																	"TimeOutAbortsMacro": true,
																	"Path": "",
																	"DisplayKind": "Window",
																	"HonourFailureSettings": true,
																	"Text": "cat /tmp/MBU_rgdata.sql | sqlite3 \"$KMVAR_instance_theDatabasePath\""
																},
																{
																	"MacroActionType": "Group",
																	"ActionName": "Create merged macro databases",
																	"Actions": [
																		{
																			"MacroActionType": "SetVariableToText",
																			"Variable": "instanceTheData",
																			"Text": "CREATE TABLE IF NOT EXISTS macros_old AS\nSELECT macros_old_temp.Group_ID, macros_old_temp.Macro_ID, macros_old_temp.Macro_Name, macros_old_temp.Macro_Status, macros_old_temp.Macro_Mod, groups_old.Group_Name\nFROM macros_old_temp\nINNER JOIN groups_old ON macros_old_temp.Group_ID = groups_old.Group_ID;\nDROP TABLE macros_old_temp;",
																			"ActionUID": 15363769
																		},
																		{
																			"MacroActionType": "ExecuteShellScript",
																			"IncludedVariables": [
																				"9999"
																			],
																			"TrimResults": true,
																			"Source": "Nothing",
																			"IncludeStdErr": false,
																			"ActionUID": 15363770,
																			"UseText": true,
																			"TrimResultsNew": true,
																			"TimeOutAbortsMacro": true,
																			"Path": "",
																			"DisplayKind": "None",
																			"HonourFailureSettings": true,
																			"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
																		}
																	],
																	"TimeOutAbortsMacro": true,
																	"ActionUID": 15363768
																},
																{
																	"MacroActionType": "Group",
																	"ActionName": "Create indices",
																	"Actions": [
																		{
																			"MacroActionType": "SetVariableToText",
																			"Variable": "instanceTheData",
																			"Text": "CREATE INDEX IF NOT EXISTS idx_groups_old\nON groups_old (Group_Name);\nCREATE INDEX IF NOT EXISTS idx_macros_old\nON macros_old (Macro_Name, Group_ID);\n",
																			"ActionUID": 15363772
																		},
																		{
																			"MacroActionType": "ExecuteShellScript",
																			"IncludedVariables": [
																				"9999"
																			],
																			"TrimResults": true,
																			"Source": "Nothing",
																			"IncludeStdErr": false,
																			"ActionUID": 15363773,
																			"UseText": true,
																			"TrimResultsNew": true,
																			"TimeOutAbortsMacro": true,
																			"Path": "",
																			"DisplayKind": "None",
																			"HonourFailureSettings": true,
																			"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
																		}
																	],
																	"TimeOutAbortsMacro": true,
																	"ActionUID": 15363771
																}
															],
															"ConditionType": "Is",
															"TestValue": "dbase missing"
														}
													],
													"Source": "Variable",
													"Variable": "local_DbaseCheck",
													"ActionUID": 15363753
												}
											],
											"ConditionType": "GreaterThanOrEqual",
											"TestValue": "1"
										}
									],
									"Source": "Variable",
									"Variable": "local_PreBackupCount",
									"ActionUID": 15363748
								},
								{
									"MacroActionType": "ExecuteMacro",
									"MacroUID": "1B868A4F-E707-4D84-ADD0-242D19C6B844",
									"ActionUID": 15363774,
									"ActionColor": "Magenta",
									"TimeOutAbortsMacro": true,
									"Parameter": "Recreate the 'old' macros database if necessary",
									"UseParameter": true,
									"Asynchronously": false
								},
								{
									"MacroActionType": "Group",
									"ActionName": "Create SQL for all groups",
									"Actions": [
										{
											"MacroActionType": "ReadFile",
											"IsDisclosed": false,
											"Source": "/tmp/MBU_rgGroupCombined",
											"Variable": "local_new_UUID_groups",
											"Destination": "Variable",
											"ActionUID": 15363776
										},
										{
											"MacroActionType": "SearchReplace",
											"ActionName": "Quote the single apostrophe for import",
											"Search": "'",
											"Source": "Variable",
											"Action": "IgnoreCaseRegEx",
											"ActionUID": 15363777,
											"Variable": "local_new_UUID_groups",
											"Which": "All",
											"Replace": "''"
										},
										{
											"MacroActionType": "SearchReplace",
											"ActionName": "Convert delimted text into SQL command",
											"Action": "IgnoreCaseRegEx",
											"ActionUID": 15363778,
											"Destination": "Variable",
											"Search": "(?m)^(.*?)###(.*?)$",
											"Source": "Variable",
											"Variable": "local_new_UUID_groups",
											"Which": "All",
											"Replace": "insert into groups_new (\"Group_ID\",\"Group_Mod\",\"Group_Name\",\"Group_Status\") values ('$1','No','$2','');",
											"DestinationVariable": "local_NewGroupSQL"
										}
									],
									"TimeOutAbortsMacro": true,
									"ActionUID": 15363775
								},
								{
									"MacroActionType": "Group",
									"ActionName": "Create SQL for all macros",
									"Actions": [
										{
											"MacroActionType": "ReadFile",
											"Source": "/tmp/MBU_rgMacroCombined",
											"Variable": "local_new_UUID_macros",
											"Destination": "Variable",
											"ActionUID": 15363780
										},
										{
											"MacroActionType": "SearchReplace",
											"ActionName": "Quote the single apostrophe for import",
											"Search": "'",
											"Source": "Variable",
											"Action": "IgnoreCaseRegEx",
											"ActionUID": 15363781,
											"Variable": "local_new_UUID_macros",
											"Which": "All",
											"Replace": "''"
										},
										{
											"MacroActionType": "SearchReplace",
											"ActionName": "Search/Replace: regex",
											"Action": "IgnoreCaseRegEx",
											"ActionUID": 15363782,
											"Destination": "Variable",
											"Search": "(?m)^(.*?)###(.*?)###(.*)$",
											"Source": "Variable",
											"Variable": "local_new_UUID_macros",
											"Which": "All",
											"Replace": "insert into macros_new_temp (\"Group_ID\",\"Macro_ID\",\"Macro_Name\",\"Macro_Mod\",\"Macro_Status\") values ('$1','$2','$3','No','');",
											"DestinationVariable": "local_NewMacrosSQL"
										}
									],
									"IsDisclosed": false,
									"TimeOutAbortsMacro": true,
									"ActionUID": 15363779
								},
								{
									"MacroActionType": "SetVariableToText",
									"ActionName": "Create tables and import newest backup's data",
									"IsDisclosed": false,
									"Variable": "instanceTheData",
									"Text": "CREATE TABLE IF NOT EXISTS \"macros_new_temp\" (\n\"Group_ID\" TEXT,\n\"Macro_ID\" TEXT PRIMARY KEY,\n\"Macro_Mod\" TEXT,\n\"Macro_Name\" TEXT,\n\"Macro_Status\" TEXT\n);\n\nCREATE TABLE IF NOT EXISTS \"groups_new\" (\n\"Group_ID\" TEXT PRIMARY KEY,\n\"Group_Mod\" TEXT,\n\"Group_Name\" TEXT,\n\"Group_Status\" TEXT\n);\n\n%Variable%local_NewGroupSQL%\n%Variable%local_NewMacrosSQL%",
									"ActionUID": 15363783
								},
								{
									"MacroActionType": "WriteFile",
									"Append": false,
									"Format2": "PlainText",
									"Format": "PlainText",
									"IsDisclosed": false,
									"Destination": "/tmp/MBU_rgdata.sql",
									"Encoding": "UTF8",
									"ActionUID": 15363784,
									"Source": "Variable",
									"Variable": "instanceTheData"
								},
								{
									"MacroActionType": "ExecuteShellScript",
									"ActionName": "Create/update the database",
									"IncludedVariables": [
										"9999"
									],
									"TrimResults": true,
									"StopOnFailure": false,
									"Source": "Nothing",
									"IncludeStdErr": false,
									"ActionUID": 15363785,
									"UseText": true,
									"TrimResultsNew": true,
									"TimeOutAbortsMacro": true,
									"Path": "",
									"DisplayKind": "Window",
									"IsDisclosed": false,
									"HonourFailureSettings": true,
									"Text": "cat /tmp/MBU_rgdata.sql | sqlite3 \"$KMVAR_instance_theDatabasePath\""
								},
								{
									"MacroActionType": "Group",
									"ActionName": "Create merged macro databases",
									"Actions": [
										{
											"MacroActionType": "SetVariableToText",
											"Variable": "instanceTheData",
											"Text": "CREATE TABLE IF NOT EXISTS macros_new AS\nSELECT macros_new_temp.Group_ID, macros_new_temp.Macro_ID, macros_new_temp.Macro_Name, macros_new_temp.Macro_Status, macros_new_temp.Macro_Mod, groups_new.Group_Name\nFROM macros_new_temp\nINNER JOIN groups_new ON macros_new_temp.Group_ID = groups_new.Group_ID;\nDROP TABLE macros_new_temp;",
											"ActionUID": 15363787
										},
										{
											"MacroActionType": "ExecuteShellScript",
											"IncludedVariables": [
												"9999"
											],
											"TrimResults": true,
											"Source": "Nothing",
											"IncludeStdErr": false,
											"ActionUID": 15363788,
											"UseText": true,
											"TrimResultsNew": true,
											"TimeOutAbortsMacro": true,
											"Path": "",
											"DisplayKind": "None",
											"HonourFailureSettings": true,
											"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
										}
									],
									"IsDisclosed": false,
									"TimeOutAbortsMacro": true,
									"ActionUID": 15363786
								},
								{
									"MacroActionType": "Group",
									"ActionName": "Create indeces",
									"Actions": [
										{
											"MacroActionType": "SetVariableToText",
											"Variable": "instanceTheData",
											"Text": "CREATE INDEX IF NOT EXISTS idx_groups_new\nON groups_new (Group_Name);\nCREATE INDEX IF NOT EXISTS idx_macros_new\nON macros_new (Macro_Name, Group_ID);\n",
											"ActionUID": 15363790
										},
										{
											"MacroActionType": "ExecuteShellScript",
											"IncludedVariables": [
												"9999"
											],
											"TrimResults": true,
											"Source": "Nothing",
											"IncludeStdErr": false,
											"ActionUID": 15363791,
											"UseText": true,
											"TrimResultsNew": true,
											"TimeOutAbortsMacro": true,
											"Path": "",
											"DisplayKind": "None",
											"HonourFailureSettings": true,
											"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
										}
									],
									"IsDisclosed": false,
									"TimeOutAbortsMacro": true,
									"ActionUID": 15363789
								}
							],
							"TimeOutAbortsMacro": true,
							"ActionUID": 15363747
						},
						{
							"MacroActionType": "ExecuteMacro",
							"MacroUID": "1B868A4F-E707-4D84-ADD0-242D19C6B844",
							"ActionUID": 15363792,
							"IsDisclosed": false,
							"ActionColor": "Magenta",
							"TimeOutAbortsMacro": true,
							"Parameter": "Prepare the 'new' macros database",
							"UseParameter": true,
							"Asynchronously": false
						}
					],
					"ConditionType": "Is",
					"TestValue": "beginDB"
				},
				{
					"Actions": [
						{
							"MacroActionType": "Comment",
							"Title": "Generic comment with Helvetica text",
							"ActionName": "Database prep for next backup run",
							"ActionUID": 15363793,
							"IsDisclosed": false,
							"ActionColor": "Yellow",
							"StyledText": "\n\t\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t\tcnRmZAAAAAAD\n\t\t\t\t\t\t\t\tAAAAAgAAAAcA\n\t\t\t\t\t\t\t\tAABUWFQucnRm\n\t\t\t\t\t\t\t\tAQAAAC5wAQAA\n\t\t\t\t\t\t\t\tKwAAAAEAAABo\n\t\t\t\t\t\t\t\tAQAAe1xydGYx\n\t\t\t\t\t\t\t\tXGFuc2lcYW5z\n\t\t\t\t\t\t\t\taWNwZzEyNTJc\n\t\t\t\t\t\t\t\tY29jb2FydGYx\n\t\t\t\t\t\t\t\tNjcxXGNvY29h\n\t\t\t\t\t\t\t\tc3VicnRmNjAw\n\t\t\t\t\t\t\t\tCntcZm9udHRi\n\t\t\t\t\t\t\t\tbFxmMFxmc3dp\n\t\t\t\t\t\t\t\tc3NcZmNoYXJz\n\t\t\t\t\t\t\t\tZXQwIEhlbHZl\n\t\t\t\t\t\t\t\tdGljYTt9Cntc\n\t\t\t\t\t\t\t\tY29sb3J0Ymw7\n\t\t\t\t\t\t\t\tXHJlZDI1NVxn\n\t\t\t\t\t\t\t\tcmVlbjI1NVxi\n\t\t\t\t\t\t\t\tbHVlMjU1O1xy\n\t\t\t\t\t\t\t\tZWQwXGdyZWVu\n\t\t\t\t\t\t\t\tMFxibHVlMDt9\n\t\t\t\t\t\t\t\tCntcKlxleHBh\n\t\t\t\t\t\t\t\tbmRlZGNvbG9y\n\t\t\t\t\t\t\t\tdGJsOztcY3Nz\n\t\t\t\t\t\t\t\tcmdiXGMwXGMw\n\t\t\t\t\t\t\t\tXGMwXGM4NDcw\n\t\t\t\t\t\t\t\tNlxjbmFtZSBj\n\t\t\t\t\t\t\t\tb250cm9sVGV4\n\t\t\t\t\t\t\t\tdENvbG9yO30K\n\t\t\t\t\t\t\t\tXHBhcmRcdHg1\n\t\t\t\t\t\t\t\tNjBcdHgxMTIw\n\t\t\t\t\t\t\t\tXHR4MTY4MFx0\n\t\t\t\t\t\t\t\teDIyNDBcdHgy\n\t\t\t\t\t\t\t\tODAwXHR4MzM2\n\t\t\t\t\t\t\t\tMFx0eDM5MjBc\n\t\t\t\t\t\t\t\tdHg0NDgwXHR4\n\t\t\t\t\t\t\t\tNTA0MFx0eDU2\n\t\t\t\t\t\t\t\tMDBcdHg2MTYw\n\t\t\t\t\t\t\t\tXHR4NjcyMFxw\n\t\t\t\t\t\t\t\tYXJkaXJuYXR1\n\t\t\t\t\t\t\t\tcmFsXHBhcnRp\n\t\t\t\t\t\t\t\tZ2h0ZW5mYWN0\n\t\t\t\t\t\t\t\tb3IwCgpcZjBc\n\t\t\t\t\t\t\t\tZnMyNiBcY2Yy\n\t\t\t\t\t\t\t\tIC59AQAAACMA\n\t\t\t\t\t\t\t\tAAABAAAABwAA\n\t\t\t\t\t\t\t\tAFRYVC5ydGYQ\n\t\t\t\t\t\t\t\tAAAAoGXMYbYB\n\t\t\t\t\t\t\t\tAAAAAAAAAAAA\n\t\t\t\t\t\t\t\tAA==\n\t\t\t\t\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t\t"
						},
						{
							"MacroActionType": "Group",
							"ActionName": "Rename the 'new' tables to become the 'old' tables",
							"Actions": [
								{
									"MacroActionType": "SetVariableToText",
									"ActionName": "The SQL commands",
									"Variable": "instanceTheData",
									"Text": "DROP TABLE IF EXISTS macros_old;\nALTER TABLE macros_new RENAME TO macros_old;\n\nDROP TABLE IF EXISTS groups_old;\nALTER TABLE groups_new RENAME TO groups_old",
									"ActionUID": 15363795
								},
								{
									"MacroActionType": "ExecuteShellScript",
									"ActionName": "Import the SQL commands",
									"IncludedVariables": [
										"9999"
									],
									"TrimResults": true,
									"Source": "Nothing",
									"IncludeStdErr": false,
									"ActionUID": 15363796,
									"UseText": true,
									"TrimResultsNew": true,
									"TimeOutAbortsMacro": true,
									"Path": "",
									"DisplayKind": "None",
									"HonourFailureSettings": true,
									"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
								}
							],
							"IsDisclosed": false,
							"TimeOutAbortsMacro": true,
							"ActionUID": 15363794
						},
						{
							"MacroActionType": "Group",
							"ActionName": "Remove the old indices",
							"Actions": [
								{
									"MacroActionType": "SetVariableToText",
									"ActionName": "The SQL commands",
									"Variable": "instanceTheData",
									"Text": "DROP INDEX idx_groups_new;\nDROP INDEX idx_macros_new;",
									"ActionUID": 15363798
								},
								{
									"MacroActionType": "ExecuteShellScript",
									"ActionName": "Import the SQL commands",
									"IncludedVariables": [
										"9999"
									],
									"TrimResults": true,
									"Source": "Nothing",
									"IncludeStdErr": false,
									"ActionUID": 15363799,
									"UseText": true,
									"TrimResultsNew": true,
									"TimeOutAbortsMacro": true,
									"Path": "",
									"DisplayKind": "None",
									"HonourFailureSettings": true,
									"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
								}
							],
							"IsDisclosed": false,
							"TimeOutAbortsMacro": true,
							"ActionUID": 15363797
						},
						{
							"MacroActionType": "Group",
							"ActionName": "Create indices",
							"Actions": [
								{
									"MacroActionType": "SetVariableToText",
									"ActionName": "The SQL commands",
									"Variable": "instanceTheData",
									"Text": "CREATE INDEX IF NOT EXISTS idx_groups_old\nON groups_old (Group_Name);\nCREATE INDEX IF NOT EXISTS idx_macros_old\nON macros_old (Macro_Name, Group_ID);\n",
									"ActionUID": 15363801
								},
								{
									"MacroActionType": "ExecuteShellScript",
									"ActionName": "Import the SQL commands",
									"IncludedVariables": [
										"9999"
									],
									"TrimResults": true,
									"Source": "Nothing",
									"IncludeStdErr": false,
									"ActionUID": 15363802,
									"UseText": true,
									"TrimResultsNew": true,
									"TimeOutAbortsMacro": true,
									"Path": "",
									"DisplayKind": "None",
									"HonourFailureSettings": true,
									"Text": "sqlite3 \"$KMVAR_instance_theDatabasePath\" << EOF\n$KMVAR_instanceTheData\nEOF"
								}
							],
							"IsDisclosed": false,
							"TimeOutAbortsMacro": true,
							"ActionUID": 15363800
						}
					],
					"ConditionType": "Is",
					"TestValue": "endDB"
				}
			],
			"Source": "Text",
			"Text": "%TriggerValue%",
			"ActionUID": 15363744
		}
	],
	"Name": "dbase | 00 Starting and ending tasks",
	"CustomIconData": "KMEC=Square=KMCOLOR:255,255,255,0==86=0=0=0=KMCOLOR:0,0,0,255"
}