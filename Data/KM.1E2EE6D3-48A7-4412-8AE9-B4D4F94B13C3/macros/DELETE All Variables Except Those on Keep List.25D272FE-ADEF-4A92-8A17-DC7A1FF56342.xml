<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<array>
	<dict>
		<key>Actions</key>
		<array>
			<dict>
				<key>ActionColor</key>
				<string>Green</string>
				<key>ActionUID</key>
				<integer>16619287</integer>
				<key>MacroActionType</key>
				<string>Comment</string>
				<key>StyledText</key>
				<data>
							cnRmZAAAAAADAAAAAgAA
							AAcAAABUWFQucnRmAQAA
							AC5mBgAAKwAAAAEAAABe
							BgAAe1xydGYxXGFuc2lc
							YW5zaWNwZzEyNTJcY29j
							b2FydGYxNjcxXGNvY29h
							c3VicnRmMjAwCntcZm9u
							dHRibFxmMFxmc3dpc3Nc
							ZmNoYXJzZXQwIEhlbHZl
							dGljYTt9CntcY29sb3J0
							Ymw7XHJlZDI1NVxncmVl
							bjI1NVxibHVlMjU1O30K
							e1wqXGV4cGFuZGVkY29s
							b3J0Ymw7O30KXHBhcmRc
							dHg1NjBcdHgxMTIwXHR4
							MTY4MFx0eDIyNDBcdHgy
							ODAwXHR4MzM2MFx0eDM5
							MjBcdHg0NDgwXHR4NTA0
							MFx0eDU2MDBcdHg2MTYw
							XHR4NjcyMFxwYXJkaXJu
							YXR1cmFsXHBhcnRpZ2h0
							ZW5mYWN0b3IwCgpcZjBc
							ZnMyNCBcY2YwIEF1dGhv
							cjogIFwnYTBcJ2EwXCdh
							MFwnYTBcJ2EwXCdhMEBK
							TWljaGFlbFRYXApcClBV
							UlBPU0U6ICBcClwnYTBc
							J2EwXCc5NSBEZWxldGUg
							QUxMIEtNIFZhcmlhYmxl
							cyBFWENFUFQgdGhvc2Ug
							b24gdGhlIEtFRVAgTGlz
							dFwKXCdhMFwnYTBcJzk1
							IFRvIGp1c3QgZ2V0IGxp
							c3Qgb2YgZXhpc3Rpbmcg
							dmFyaWFibGVzLCBDQU5D
							RUwgd2hlbiBwcm9tcHRl
							ZCB0byBjb25maXJtIGRl
							bGV0aW9uLiAgTm8gdmFy
							aWFibGVzIGFyZSBkZWxl
							dGVkIGlmIENBTkNFTEVE
							LlwKXCdhMFwnYTBcJzk1
							IFJlc3VsdHMgYXJlIGNv
							cGllZCB0byBDbGlwYm9h
							cmQsIGFuZCBkaXNwbGF5
							ZWQgaW4gd2luZG93LlwK
							XApIT1cgVE8gVVNFOlwK
							KDEpIEVkaXQgdGhlIEtF
							RVAgTGlzdCBiZWxvd1wn
							YTBcJ2EwKioqIElNUE9S
							VEFOVCAqKipcCigyKSBS
							dW4gdGhpcyBtYWNyb1wK
							KDMpIENBTkNFTCB0byBz
							dG9wIHByb2Nlc3MgYW5k
							IGRpc3BsYXkgbGlzdCBv
							ZiBjdXJyZW50IEtNIFZh
							cmlhYmxlc1wKXApVU0VS
							IFNFVFRJTkdTOlwKXCdh
							MFwnYTBcJzk1XCdhMEFu
							eSBBY3Rpb24gaW4gbWFn
							ZW50YSBjb2xvciBpcyBk
							ZXNpZ25lZCB0byBiZSBj
							aGFuZ2VkIGJ5IGVuZC11
							c2VyXApcJ2EwXCdhMFwn
							OTVcJ2EwVGhpcyBtYWNy
							byB1c2VzIEdvb2dsZSBT
							ZWFyY2ggYW5kIEdvb2ds
							ZSBDaHJvbWUsIGJ1dCBj
							YW4gYmUgZWFzaWx5IGNo
							YW5nZWRcClwKQUNUSU9O
							IENPTE9SIENPREVTXApc
							J2EwXCdhMFwnOTVcJ2Ew
							VG8gZmFjaWxpdGF0ZSB0
							aGUgcmVhZGluZywgY3Vz
							dG9taXppbmcsIGFuZCBt
							YWludGVuYW5jZSBvZiB0
							aGlzIG1hY3JvLFwKXCdh
							MFwnYTBcJ2EwXCdhMFwn
							YTBcJ2Ewa2V5IEFjdGlv
							bnMgYXJlIGNvbG9yZWQg
							YXMgZm9sbG93czpcClwn
							YTBcJ2EwXCc5NVwnYTBH
							UkVFTlwnYTBcJ2EwXCdh
							MFwnYTBcJ2EwIC0tIEtl
							eSBDb21tZW50cyBkZXNp
							Z25lZCB0byBoaWdobGln
							aHQgbWFpbiBzZWN0aW9u
							cyBvZiBtYWNyb1wKXCdh
							MFwnYTBcJzk1XCdhME1B
							R0VOVEEgLS0gQWN0aW9u
							cyBkZXNpZ25lZCB0byBi
							ZSBjdXN0b21pemVkIGJ5
							IHVzZXJcClwnYTBcJ2Ew
							XCc5NVwnYTBZRUxMT1dc
							J2EwXCdhMFwnYTAtLSBQ
							cmltYXJ5IEFjdGlvbnMg
							KHVzdWFsbHkgdGhlIG1h
							aW4gcHVycG9zZSBvZiB0
							aGUgbWFjcm8pXApcJ2Ew
							XCdhMFwnOTVcJ2EwT1JB
							TkdFXCdhMFwnYTAtLSBB
							Y3Rpb25zIHRoYXQgcGVy
							bWFuZW50bHkgZGVzdHJv
							eSBWYXJpYmxlcyBvciBD
							bGlwYm9hcmRzXApcClJF
							UVVJUkVTOiAgXAooMSkg
							IEtleWJvYXJkIE1hZXN0
							cm8gVmVyIDcuMC4zK1wK
							KDIpICBZb3NlbWl0ZSAo
							MTAuMTAuNSkrXAp+fn5+
							fn5+fn5+fn5+fn5+fn5+
							fn5+fn5+fn5+fn5+fn5+
							fn5+fn5+fn5+fn5+fQEA
							AAAjAAAAAQAAAAcAAABU
							WFQucnRmEAAAAPEUKVy2
							AQAAAAAAAAAAAAA=
							</data>
				<key>Title</key>
				<string>~~~~~ Ver 1.1   2016-04-15 ~~~~~</string>
			</dict>
			<dict>
				<key>ActionColor</key>
				<string>Green</string>
				<key>ActionUID</key>
				<integer>16619288</integer>
				<key>MacroActionType</key>
				<string>Comment</string>
				<key>StyledText</key>
				<data>
							e1xydGYxXGFuc2lcYW5z
							aWNwZzEyNTJcY29jb2Fy
							dGYyNzU5Clxjb2NvYXRl
							eHRzY2FsaW5nMFxjb2Nv
							YXBsYXRmb3JtMHtcZm9u
							dHRibH0Ke1xjb2xvcnRi
							bDtccmVkMjU1XGdyZWVu
							MjU1XGJsdWUyNTU7fQp7
							XCpcZXhwYW5kZWRjb2xv
							cnRibDs7fQp9
							</data>
				<key>Title</key>
				<string>~~~ COMMENT ~~~</string>
			</dict>
			<dict>
				<key>ActionColor</key>
				<string>Magenta</string>
				<key>ActionName</key>
				<string>Set KEEP List of KM Variables</string>
				<key>ActionUID</key>
				<integer>16619289</integer>
				<key>MacroActionType</key>
				<string>SetVariableToText</string>
				<key>Text</key>
				<string>DND__KM_Var_Del_Results
DND__KM_Vars_To_Keep
DND__LastUpdateCalender
DND__kmfamResourcesFolderPath
DND__kmfamWindowPosition
DND__LastMsg
ENC__Config
kmfamcResult
kmfamFavoriteActionDialogIsRunning
kmfamOptions
kmfamPickListSize
kmfamPreferencesFolderName
kmfamPreferencesFolderPath
kmfamRequest
kmfamSelectData
kmfamWindowHeightWithoutPickList
kmfamActionName
kmfamActionType
kmfamMacroNameFocused
kmfamUpdatedUsageData
</string>
				<key>Variable</key>
				<string>DND__KM_Vars_To_Keep</string>
			</dict>
			<dict>
				<key>ActionColor</key>
				<string>Teal</string>
				<key>ActionName</key>
				<string>Execute JXA Script to Delete KM Variables NOT on Keep List</string>
				<key>ActionUID</key>
				<integer>16619290</integer>
				<key>DisplayKind</key>
				<string>Variable</string>
				<key>HonourFailureSettings</key>
				<true/>
				<key>IncludeStdErr</key>
				<false/>
				<key>IncludedVariables</key>
				<array>
					<string>9999</string>
				</array>
				<key>MacroActionType</key>
				<string>ExecuteJavaScriptForAutomation</string>
				<key>NotifyOnFailure</key>
				<false/>
				<key>Path</key>
				<string></string>
				<key>StopOnFailure</key>
				<false/>
				<key>Text</key>
				<string>/*
⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶
	[KM] Delete ALL KM Variables NOT in Keep List
⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶

DATE:    Fri, Apr 15, 2016
AUTHOR:  JMichaelTX 

REF:     The following were used in some way in the development of this script

	• JXA Script by Rob Trent (@CompactPoint)
		Deleting (some) Keyboard Maestro variables – protecting others
		https://forum.keyboardmaestro.com/t/deleting-some-keyboard-maestro-variables-protecting-others/3301
⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶⩶
*/

'use strict';

var app = Application.currentApplication()
app.includeStandardAdditions = true


function run(){


var kmeApp = Application("com.stairways.keyboardmaestro.engine")
	
	//--- GET ARRAY OF ALL CURRENT KM VARIABLE NAMES ---
	// this is much faster than using the KM Variable object itself
	
	var kmVarNameArr = kmeApp.variables.name()		

	//--- GET LIST OF KM VARIABLES TO KEEP ---
	var kmVarToKeepArr = kmeApp.variables["DND__KM_Vars_To_Keep"].value().split("\n")

	//--- MAKE LIST OF VARIABLES TO DELETE ---
    var  kmVarToDelArr = kmVarNameArr
        .filter(function (iVar) {
            return kmVarToKeepArr.indexOf(iVar) === -1;
        })

		var numToDelete = kmVarToDelArr.length

		//--- CONFIRM DELETION WITH USER ---
		
		var msgStr = "Num of KM Variables to DELETE: " + numToDelete
		msgStr += "\n\nWARNING!  These KM Variables will be PERMANENTLY DELETED"
		msgStr += "\nCANCEL to see list of all current variables"
		var titleStr = "Keyboard Maestro Variable DELETION"
		
		var btnStr = dispDialog(msgStr,
        		{
          		withTitle:      titleStr
          		,withIcon:      "caution"
      		    ,buttons:       ["Cancel","Delete"]
  		        ,defaultButton: "Delete"
	          })
		
	//--------------------------------------------------------
		if (btnStr === "Cancel") {	// ### CANCEL PROCESS ###
	//--------------------------------------------------------
			var outputStr = "User CANCELED process.  NO KM Variables were deleted"
			outputStr += "\n\nVARIABLES TO KEEP:\n" + kmVarToKeepArr.join("\n")
			outputStr += "\n\nCURRENT VARIABLES\n" + kmVarNameArr.join("\n")
		}
		
	//-----------------------------------------------------	
		else {	// ### PROCEED WITH DELETION ###
	//-----------------------------------------------------
	
			var kmVars = kmeApp.variables

			kmVarToDelArr.forEach(function (iKMVar) {
				//console.log(iKMVar);
				kmVars[iKMVar].value = '%Delete%'
			})
			
			var outputStr = ""
			outputStr += "VARIABLES THAT WERE KEPT:\n\t" + kmVarToKeepArr.join("\n\t")
			outputStr += "\n\nDELETED VARIABLES:\n\t" + kmVarToDelArr.join("\n\t")
			

	} // ~~~ END else ~~~
	
	//----------------
	return outputStr
	//----------------
	
}	// ~~~~~~~~~~~~~~~~~~~~~ END function run() ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


function dispDialog (pMsg, pOptionsObj)	{
	//——————————————————————————————————————————————
	//			dispDialog()			Display Standard Dialog
	//
	//			Ver 1.0		2016-04-12
	//——————————————————————————————————————————————
	
	app.beep()
	
	try {
		var oAns = app.displayDialog(pMsg, pOptionsObj)            
		var btnStr = oAns.buttonReturned
	}
	catch (e) {		
			if (e.errorNumber === -128) {
				console.log("User CANCELED process.")
				btnStr = "Cancel"
			}
			else {
				console.log(e)
				e.errornumber
			}
	}
	return btnStr

}	// --- END function dispDialog ---
</string>
				<key>TimeOutAbortsMacro</key>
				<true/>
				<key>TrimResults</key>
				<true/>
				<key>TrimResultsNew</key>
				<true/>
				<key>UseModernSyntax</key>
				<false/>
				<key>UseText</key>
				<true/>
				<key>Variable</key>
				<string>DND__KM_Var_Del_Results</string>
			</dict>
			<dict>
				<key>ActionName</key>
				<string>Set Clipboard RESULTS of Script</string>
				<key>ActionUID</key>
				<integer>16619291</integer>
				<key>JustDisplay</key>
				<false/>
				<key>MacroActionType</key>
				<string>SetClipboardToText</string>
				<key>Text</key>
				<string>%DND__KM_Var_Del_Results%</string>
			</dict>
			<dict>
				<key>Action</key>
				<string>DisplayWindow</string>
				<key>ActionName</key>
				<string>Displaly RESULTS of Script</string>
				<key>ActionUID</key>
				<integer>16619292</integer>
				<key>MacroActionType</key>
				<string>InsertText</string>
				<key>StyledText</key>
				<data>
							cnRmZAAAAAADAAAAAgAA
							AAcAAABUWFQucnRmAQAA
							AC4nAQAAKwAAAAEAAAAf
							AQAAe1xydGYxXGFuc2lc
							YW5zaWNwZzEyNTJcY29j
							b2FydGYxMzQ4XGNvY29h
							c3VicnRmMTcwCntcZm9u
							dHRibFxmMFxmbmlsXGZj
							aGFyc2V0MCBIZWx2ZXRp
							Y2FOZXVlO30Ke1xjb2xv
							cnRibDtccmVkMjU1XGdy
							ZWVuMjU1XGJsdWUyNTU7
							fQpccGFyZFx0eDU2MFx0
							eDExMjBcdHgxNjgwXHR4
							MjI0MFx0eDI4MDBcdHgz
							MzYwXHR4MzkyMFx0eDQ0
							ODBcdHg1MDQwXHR4NTYw
							MFx0eDYxNjBcdHg2NzIw
							XHBhcmRpcm5hdHVyYWwK
							ClxmMFxmczI2IFxjZjAg
							JVZhcmlhYmxlJURORF9f
							S01fVmFyX0RlbF9SZXN1
							bHRzJX0BAAAAIwAAAAEA
							AAAHAAAAVFhULnJ0ZhAA
							AABDaRFXtgEAAAAAAAAA
							AAAA
							</data>
				<key>Text</key>
				<string>%Variable%DND__KM_Var_Del_Results%</string>
			</dict>
		</array>
		<key>CreationDate</key>
		<real>482219870.20461297</real>
		<key>CustomIconData</key>
		<string>KMEP-GenericApplication-/Applications/Keyboard Maestro.app</string>
		<key>ModificationDate</key>
		<real>759505499.61479902</real>
		<key>Name</key>
		<string>DELETE All Variables Except Those on Keep List</string>
		<key>Triggers</key>
		<array/>
		<key>UID</key>
		<string>25D272FE-ADEF-4A92-8A17-DC7A1FF56342</string>
	</dict>
</array>
</plist>
