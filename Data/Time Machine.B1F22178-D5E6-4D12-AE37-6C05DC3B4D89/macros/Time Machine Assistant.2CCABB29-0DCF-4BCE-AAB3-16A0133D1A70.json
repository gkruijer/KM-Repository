{
	"UID": "2CCABB29-0DCF-4BCE-AAB3-16A0133D1A70",
	"CreationDate": 735200735.305171,
	"ModificationDate": 735914859.559679,
	"Triggers": [
		{
			"MacroTriggerType": "StatusMenu"
		}
	],
	"Actions": [
		{
			"MacroActionType": "Comment",
			"Title": "",
			"ActionName": "MACRO DESCRIPTION",
			"StyledText": "\n\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\tcnRmZAAAAAADAAAAAgAA\n\t\t\t\t\t\t\tAAcAAABUWFQucnRmAQAA\n\t\t\t\t\t\t\tAC5eDAAAKwAAAAEAAABW\n\t\t\t\t\t\t\tDAAAe1xydGYxXGFuc2lc\n\t\t\t\t\t\t\tYW5zaWNwZzEyNTJcY29j\n\t\t\t\t\t\t\tb2FydGYyNzYxClxjb2Nv\n\t\t\t\t\t\t\tYXRleHRzY2FsaW5nMFxj\n\t\t\t\t\t\t\tb2NvYXBsYXRmb3JtMHtc\n\t\t\t\t\t\t\tZm9udHRibFxmMFxmbmls\n\t\t\t\t\t\t\tXGZjaGFyc2V0MCBIZWx2\n\t\t\t\t\t\t\tZXRpY2FOZXVlLUJvbGQ7\n\t\t\t\t\t\t\tXGYxXGZuaWxcZmNoYXJz\n\t\t\t\t\t\t\tZXQwIEhlbHZldGljYU5l\n\t\t\t\t\t\t\tdWU7fQp7XGNvbG9ydGJs\n\t\t\t\t\t\t\tO1xyZWQyNTVcZ3JlZW4y\n\t\t\t\t\t\t\tNTVcYmx1ZTI1NTtccmVk\n\t\t\t\t\t\t\tMTUzXGdyZWVuMTAyXGJs\n\t\t\t\t\t\t\tdWU1MTtccmVkMFxncmVl\n\t\t\t\t\t\t\tbjBcYmx1ZTA7XHJlZDE1\n\t\t\t\t\t\t\tNlxncmVlbjE1NlxibHVl\n\t\t\t\t\t\t\tMTU2Owp9CntcKlxleHBh\n\t\t\t\t\t\t\tbmRlZGNvbG9ydGJsOztc\n\t\t\t\t\t\t\tY3NzcmdiXGM2NjgwMFxj\n\t\t\t\t\t\t\tNDc1MTJcYzI1ODYwO1xj\n\t\t\t\t\t\t\tc3NyZ2JcYzBcYzBcYzA7\n\t\t\t\t\t\t\tXGNzc3JnYlxjNjc0NTFc\n\t\t\t\t\t\t\tYzY3NDUxXGM2NzQ1MTsK\n\t\t\t\t\t\t\tfQpccGFyZFx0eDU2MFx0\n\t\t\t\t\t\t\teDExMjBcdHgxNjgwXHR4\n\t\t\t\t\t\t\tMjI0MFx0eDI4MDBcdHgz\n\t\t\t\t\t\t\tMzYwXHR4MzkyMFx0eDQ0\n\t\t\t\t\t\t\tODBcdHg1MDQwXHR4NTYw\n\t\t\t\t\t\t\tMFx0eDYxNjBcdHg2NzIw\n\t\t\t\t\t\t\tXHBhcmRpcm5hdHVyYWxc\n\t\t\t\t\t\t\tcGFydGlnaHRlbmZhY3Rv\n\t\t\t\t\t\t\tcjAKClxmMFxiXGZzMjYg\n\t\t\t\t\t\t\tXGNmMCBUaW1lIE1hY2hp\n\t\t\t\t\t\t\tbmUgQXNzaXN0YW50Clxm\n\t\t\t\t\t\t\tMVxiMCAsIHYxLjBcCnJl\n\t\t\t\t\t\t\tdmlzZWQ6IDIwMjQtMDQt\n\t\t\t\t\t\t\tMjYsIEppbSBTYXVlclwK\n\t\t\t\t\t\t\tXHBhcmRccGFyZGVmdGFi\n\t\t\t\t\t\t\tNTYwXHNsbGVhZGluZzIw\n\t\t\t\t\t\t\tXHBhcnRpZ2h0ZW5mYWN0\n\t\t\t\t\t\t\tb3IwCgpcZjBcYiBcY2Yy\n\t\t\t\t\t\t\tIFwKUFVSUE9TRVwKXHBh\n\t\t\t\t\t\t\tcmRcdHg1NjBcdHgxMTIw\n\t\t\t\t\t\t\tXHR4MTY4MFx0eDIyNDBc\n\t\t\t\t\t\t\tdHgyODAwXHR4MzM2MFx0\n\t\t\t\t\t\t\teDM5MjBcdHg0NDgwXHR4\n\t\t\t\t\t\t\tNTA0MFx0eDU2MDBcdHg2\n\t\t\t\t\t\t\tMTYwXHR4NjcyMFxwYXJk\n\t\t\t\t\t\t\taXJuYXR1cmFsXHBhcnRp\n\t\t\t\t\t\t\tZ2h0ZW5mYWN0b3IwCgpc\n\t\t\t\t\t\t\tZjFcYjAgXGNmMyBUaGlz\n\t\t\t\t\t\t\tIG1hY3JvIHByb3ZpZGVz\n\t\t\t\t\t\t\tXGV4cG5kMFxleHBuZHR3\n\t\t\t\t\t\t\tMFxrZXJuaW5nMApcJ2Ew\n\t\t\t\t\t\t\te1xmaWVsZHtcKlxmbGRp\n\t\t\t\t\t\t\tbnN0e0hZUEVSTElOSyAi\n\t\t\t\t\t\t\taHR0cHM6Ly9zdXBwb3J0\n\t\t\t\t\t\t\tLmFwcGxlLmNvbS9lbi11\n\t\t\t\t\t\t\tcy8xMDQ5ODQifX17XGZs\n\t\t\t\t\t\t\tZHJzbHQgXHVsIFx1bGM0\n\t\t\t\t\t\t\tIFRpbWUgTWFjaGluZX19\n\t\t\t\t\t\t\tXCdhMFxrZXJuaW5nMVxl\n\t\t\t\t\t\t\teHBuZDBcZXhwbmR0dzAg\n\t\t\t\t\t\t\taW5mb3JtYXRpb24gYW5k\n\t\t\t\t\t\t\tIGNvbnRyb2wuXApcCk5v\n\t\t\t\t\t\t\tIGNvbmZpZ3VyYXRpb25z\n\t\t\t\t\t\t\tIGlzIHJlcXVpcmVkIGFz\n\t\t\t\t\t\t\tIGFsbCBpbmZvcm1hdGlv\n\t\t\t\t\t\t\tbiBpcyByZXRyaWV2ZWQg\n\t\t\t\t\t\t\tZnJvbVxleHBuZDBcZXhw\n\t\t\t\t\t\t\tbmR0dzBca2VybmluZzAK\n\t\t\t\t\t\t\tXCdhMHtcZmllbGR7XCpc\n\t\t\t\t\t\t\tZmxkaW5zdHtIWVBFUkxJ\n\t\t\t\t\t\t\tTksgImh0dHBzOi8vc3M2\n\t\t\t\t\t\t\tNC5jb20vbWFjL3RtdXRp\n\t\t\t\t\t\t\tbC5odG1sIn19e1xmbGRy\n\t\t\t\t\t\t\tc2x0IFx1bCBcdWxjNCB0\n\t\t\t\t\t\t\tbXV0aWx9fVwnYTBca2Vy\n\t\t\t\t\t\t\tbmluZzFcZXhwbmQwXGV4\n\t\t\t\t\t\t\tcG5kdHcwIGFuZCB7XGZp\n\t\t\t\t\t\t\tZWxke1wqXGZsZGluc3R7\n\t\t\t\t\t\t\tSFlQRVJMSU5LICJodHRw\n\t\t\t\t\t\t\tczovL3NzNjQuY29tL21h\n\t\t\t\t\t\t\tYy9kaXNrdXRpbC5odG1s\n\t\t\t\t\t\t\tIn19e1xmbGRyc2x0IFxl\n\t\t\t\t\t\t\teHBuZDBcZXhwbmR0dzBc\n\t\t\t\t\t\t\ta2VybmluZzAKXHVsIFx1\n\t\t\t\t\t\t\tbGM0IGRpc2t1dGlsfX1c\n\t\t\t\t\t\t\tZXhwbmQwXGV4cG5kdHcw\n\t\t\t\t\t\t\tXGtlcm5pbmcwCi5cClxw\n\t\t\t\t\t\t\tYXJkXHR4NTYwXHR4MTEy\n\t\t\t\t\t\t\tMFx0eDE2ODBcdHgyMjQw\n\t\t\t\t\t\t\tXHR4MjgwMFx0eDMzNjBc\n\t\t\t\t\t\t\tdHgzOTIwXHR4NDQ4MFx0\n\t\t\t\t\t\t\teDUwNDBcdHg1NjAwXHR4\n\t\t\t\t\t\t\tNjE2MFx0eDY3MjBccGFy\n\t\t\t\t\t\t\tZGlybmF0dXJhbFxwYXJ0\n\t\t\t\t\t\t\taWdodGVuZmFjdG9yMApc\n\t\t\t\t\t\t\tY2YwIFwKXHBhcmRccGFy\n\t\t\t\t\t\t\tZGVmdGFiNTYwXHNsbGVh\n\t\t\t\t\t\t\tZGluZzIwXHBhcnRpZ2h0\n\t\t\t\t\t\t\tZW5mYWN0b3IwCgpcZjBc\n\t\t\t\t\t\t\tYiBcY2YyIFxrZXJuaW5n\n\t\t\t\t\t\t\tMVxleHBuZDBcZXhwbmR0\n\t\t\t\t\t\t\tdzAgSU1QTEVNRU5UQVRJ\n\t\t\t\t\t\t\tT04gTk9URVwKXHBhcmRc\n\t\t\t\t\t\t\tdHg1NjBcdHgxMTIwXHR4\n\t\t\t\t\t\t\tMTY4MFx0eDIyNDBcdHgy\n\t\t\t\t\t\t\tODAwXHR4MzM2MFx0eDM5\n\t\t\t\t\t\t\tMjBcdHg0NDgwXHR4NTA0\n\t\t\t\t\t\t\tMFx0eDU2MDBcdHg2MTYw\n\t\t\t\t\t\t\tXHR4NjcyMFxwYXJkaXJu\n\t\t\t\t\t\t\tYXR1cmFsXHBhcnRpZ2h0\n\t\t\t\t\t\t\tZW5mYWN0b3IwCgpcZjFc\n\t\t\t\t\t\t\tYjAgXGNmMyBUaGlzIG1h\n\t\t\t\t\t\t\tY3JvIGluY2x1ZGVzIG9u\n\t\t\t\t\t\t\tbHkgb25lIGFjdGlvbiwg\n\t\t\t\t\t\t\tYW5cZXhwbmQwXGV4cG5k\n\t\t\t\t\t\t\tdHcwXGtlcm5pbmcwClwn\n\t\t\t\t\t\t\tYTB7XGZpZWxke1wqXGZs\n\t\t\t\t\t\t\tZGluc3R7SFlQRVJMSU5L\n\t\t\t\t\t\t\tICJodHRwczovL3dpa2ku\n\t\t\t\t\t\t\ta2V5Ym9hcmRtYWVzdHJv\n\t\t\t\t\t\t\tLmNvbS9hY3Rpb24vRXhl\n\t\t\t\t\t\t\tY3V0ZV9hbl9BcHBsZVNj\n\t\t\t\t\t\t\tcmlwdCJ9fXtcZmxkcnNs\n\t\t\t\t\t\t\tdCBcdWwgXHVsYzQgRXhl\n\t\t\t\t\t\t\tY3V0ZSBhbiBBcHBsZVNj\n\t\t\t\t\t\t\tcmlwdH19XCdhMHRoYXQg\n\t\t\t\t\t\t\tY29udGFpbnMgdGhlIHNj\n\t\t\t\t\t\t\tcmlwdCB0aGUgcmVwb3J0\n\t\t\t\t\t\t\tcyBhbmQgY29udHJvbHMg\n\t\t\t\t\t\t\tVGltZSBNYWNoaW5lLiBT\n\t\t\t\t\t\t\taW5jZSBhbGwgb2YgdGhl\n\t\t\t\t\t\t\tIG1hY3JvIGxvZ2ljIGlz\n\t\t\t\t\t\t\tIGNvbnRhaW5lZCBpbiB0\n\t\t\t\t\t\t\taGlzIHNpbmdsZSBzY3Jp\n\t\t\t\t\t\t\tcHQsIGl0IGNhbiBiZSBy\n\t\t\t\t\t\t\tdW4gbGlrZSBhbnkgb3Ro\n\t\t\t\t\t\t\tZXIgQXBwbGVTY3JpcHQu\n\t\t\t\t\t\t\tIEkgdXNlXGNmMCBcJ2Ew\n\t\t\t\t\t\t\te1xmaWVsZHtcKlxmbGRp\n\t\t\t\t\t\t\tbnN0e0hZUEVSTElOSyAi\n\t\t\t\t\t\t\taHR0cHM6Ly9yZWRzd2Vh\n\t\t\t\t\t\t\tdGVyLmNvbS9mYXN0c2Ny\n\t\t\t\t\t\t\taXB0cy8ifX17XGZsZHJz\n\t\t\t\t\t\t\tbHQgXGNmNCBcdWwgXHVs\n\t\t\t\t\t\t\tYzQgRmFzdFNjcmlwdHMg\n\t\t\t\t\t\t\tM319XGNmMyAgYmVjYXVz\n\t\t\t\t\t\t\tZSBpdCBwcm92aWRlcyBz\n\t\t\t\t\t\t\tb21lIG5pY2UgQXBwbGVT\n\t\t\t\t\t\t\tY3JpcHQtcmVsYXRlZCBl\n\t\t\t\t\t\t\tbmhhbmNlbWVudHMuClxm\n\t\t\t\t\t\t\tMFxiIFxjZjIgXGtlcm5p\n\t\t\t\t\t\t\tbmcxXGV4cG5kMFxleHBu\n\t\t\t\t\t\t\tZHR3MCBcClxwYXJkXHBh\n\t\t\t\t\t\t\tcmRlZnRhYjU2MFxzbGxl\n\t\t\t\t\t\t\tYWRpbmcyMFxwYXJ0aWdo\n\t\t\t\t\t\t\tdGVuZmFjdG9yMApcY2Yy\n\t\t\t\t\t\t\tIFwKVEVTVEVEIFdJVEhc\n\t\t\t\t\t\t\tClxwYXJkXHR4NTYwXHR4\n\t\t\t\t\t\t\tMTEyMFx0eDE2ODBcdHgy\n\t\t\t\t\t\t\tMjQwXHR4MjgwMFx0eDMz\n\t\t\t\t\t\t\tNjBcdHgzOTIwXHR4NDQ4\n\t\t\t\t\t\t\tMFx0eDUwNDBcdHg1NjAw\n\t\t\t\t\t\t\tXHR4NjE2MFx0eDY3MjBc\n\t\t\t\t\t\t\tcGFyZGlybmF0dXJhbFxw\n\t\t\t\t\t\t\tYXJ0aWdodGVuZmFjdG9y\n\t\t\t\t\t\t\tMAoKXGYxXGIwIFxjZjAg\n\t\t\t\t\t\t\tXCc5NSBLZXlib2FyZCBN\n\t\t\t\t\t\t\tYWVzdHJvIDExLjAuMlwK\n\t\t\t\t\t\t\tXCc5NSBTb25vbWEgMTQu\n\t\t\t\t\t\t\tNC4xICgyM0UyMjQpL01h\n\t\t\t\t\t\t\tY0Jvb2tQcm8xOCwyXApc\n\t\t\t\t\t\t\tJzk1IFNvbm9tYSAxNC40\n\t\t\t\t\t\t\tLjEgKDIzRTIyNCkvVmFy\n\t\t\t\t\t\t\taWFibGVNYWNCb29rUHJv\n\t\t\t\t\t\t\tMTYsMVwKXCc5NSBNb2ph\n\t\t\t\t\t\t\tdmUgMTAuMTQuMTYvTWFj\n\t\t\t\t\t\t\tbWluaTYsMlwKXCc5NSBI\n\t\t\t\t\t\t\taWdoIFNpZXJyYSAxMC4x\n\t\t\t\t\t\t\tMy42L2lNYWMxMSwxNDQ1\n\t\t\t\t\t\t\tClxmMFxiIFxjZjIgXApc\n\t\t\t\t\t\t\tcGFyZFxwYXJkZWZ0YWI1\n\t\t\t\t\t\t\tNjBcc2xsZWFkaW5nMjBc\n\t\t\t\t\t\t\tcGFydGlnaHRlbmZhY3Rv\n\t\t\t\t\t\t\tcjAKClxmMVxiMCBcY2Yw\n\t\t\t\t\t\t\tIFwKXHBhcmRccGFyZGVm\n\t\t\t\t\t\t\tdGFiNTYwXHNsbGVhZGlu\n\t\t\t\t\t\t\tZzIwXHBhcnRpZ2h0ZW5m\n\t\t\t\t\t\t\tYWN0b3IwCgpcZjBcYiBc\n\t\t\t\t\t\t\tY2YyIFZFUlNJT04gSElT\n\t\t\t\t\t\t\tVE9SWQpcZjFcYjAgXGNm\n\t\t\t\t\t\t\tMCBcClxwYXJkXHBhcmRl\n\t\t\t\t\t\t\tZnRhYjU2MFxzbGxlYWRp\n\t\t\t\t\t\t\tbmcyMFxwYXJ0aWdodGVu\n\t\t\t\t\t\t\tZmFjdG9yMAoKXGYwXGIg\n\t\t\t\t\t\t\tXGNmMyAxLjAgClxmMVxi\n\t\t\t\t\t\t\tMCBpbml0aWFsIHZlcnNp\n\t\t\t\t\t\t\tb25cClwKVGhlIGxhdGVz\n\t\t\t\t\t\t\tdCB2ZXJzaW9uIG9mIHRo\n\t\t\t\t\t\t\taXMgbWFjcm8gaXMgYXZh\n\t\t\t\t\t\t\taWxhYmxlIG9uIHRoZSB7\n\t\t\t\t\t\t\tXGZpZWxke1wqXGZsZGlu\n\t\t\t\t\t\t\tc3R7SFlQRVJMSU5LICJo\n\t\t\t\t\t\t\tdHRwczovL2ZvcnVtLmtl\n\t\t\t\t\t\t\teWJvYXJkbWFlc3Ryby5j\n\t\t\t\t\t\t\tb20ifX17XGZsZHJzbHQg\n\t\t\t\t\t\t\tS2V5Ym9hcmQgTWFlc3Ry\n\t\t\t\t\t\t\tbyBGb3J1bX19Ln0BAAAA\n\t\t\t\t\t\t\tIwAAAAEAAAAHAAAAVFhU\n\t\t\t\t\t\t\tLnJ0ZhAAAAAQgyxmtgEA\n\t\t\t\t\t\t\tAAAAAAAAAAAA\n\t\t\t\t\t\t\t41E4D515-C065-4C24-9859-EA2479C52CC9\n\t\t\t\t\t\t\t",
			"ActionColor": "Magenta",
			"ActionUID": 15861900
		},
		{
			"MacroActionType": "ExecuteAppleScript",
			"IncludedVariables": [
				"9999"
			],
			"TrimResults": true,
			"IncludeStdErr": false,
			"ActionUID": 15862296,
			"UseText": true,
			"TrimResultsNew": true,
			"TimeOutAbortsMacro": true,
			"Path": "",
			"DisplayKind": "None",
			"HonourFailureSettings": true,
			"Text": "-- ············································································································\r-- Title            : Time Machine Assistant, v1.0\r-- Modified\t     : 2024-04-26\r-- Author\t     : Jim Sauer, [@_jims](https://forum.keyboardmaestro.com/u/_jims/summary)\r-- Purpose\t     : This script provides Time Machine information and control. No configurations is \r--                      required as all information is retrieved from tmutil and diskutil.\r-- Tested With. : Sonoma 14.4.1 (23E224)/MacBookPro18,2\r-- ············································································································\r-- Version History\r-- v1.0 - initial version\r--\r-- The latest version of this macro is available on the \r-- [Keyboard Maestro Forum](https://forum.keyboardmaestro.com/)\r-- ············································································································\r\rset myName to myName()\r\rset tmDestinationsInfo to getTmDestinationsInfo()\r\rset tmDestinationsDiskutilInfo to getTmDestinationsDiskutilInfo(tmDestinationsInfo)\r\rset tmStatus to getTmStatus(tmDestinationsInfo, tmDestinationsDiskutilInfo)\r\rset buttonList to {}\r\rif tmStatus's backup_phase is not \"\" then\r\t\r\tif tmStatus's encryption then\r\t\tset encryptionStr to \"Yes\"\r\telse\r\t\tset encryptionStr to \"No\"\r\tend if\r\t\r\tset dialogResult to display dialog ¬\r\t\t\"Time Machine Status : \" & tmStatus's backup_phase & return & return & ¬\r\t\t\"Backup Volume : \" & tmStatus's label & return & ¬\r\t\t\"Encryption : \" & encryptionStr & return ¬\r\t\twith title myName buttons {\"Interrupt & Eject\", \"Wait & Eject\", \"Cancel\"} ¬\r\t\tdefault button {\"Cancel\"}\r\t\r\tif button returned of dialogResult is \"Interrupt & Eject\" then\r\t\t\r\t\tdo shell script \"tmutil stopbackup\"\r\t\tdo shell script \"diskutil unmountDisk \" & quoted form of tmStatus's mount_point\r\t\tdisplay notification \"Time Machine backup has been interrupted and \" & ¬\r\t\t\tquoted form of tmStatus's label & \" has been ejected.\" with title myName\r\t\t\r\telse if button returned of dialogResult is \"Wait & Eject\" then\r\t\t\r\t\tset timeoutLimit to 10\r\t\tset startTime to current date\r\t\t\r\t\trepeat\r\t\t\tset tmStatus to getTmStatus(tmDestinationsInfo, tmDestinationsDiskutilInfo)\r\t\t\tif tmStatus's backup_phase is \"\" then\r\t\t\t\texit repeat\r\t\t\tend if\r\t\t\tdelay 1\r\t\t\tif ((current date) - startTime) > timeoutLimit then\r\t\t\t\tdisplay dialog \"Time Machine to \" & tmStatus's label & ¬\r\t\t\t\t\t\" was running. An attempt to stop it failed after \" & timeoutLimit & ¬\r\t\t\t\t\t\" seconds.\" with title myName buttons {\"OK\"} default button {\"OK\"}\r\t\t\t\treturn \"Timeout\"\r\t\t\tend if\r\t\tend repeat\r\t\t\r\t\tdo shell script \"diskutil unmountDisk \" & quoted form of tmStatus's mount_point\r\t\tdisplay notification \"Time Machine backup has been interrupted and '\" & ¬\r\t\t\ttmStatus's label & \"' has been ejected.\" with title myName\r\t\t\r\t\t\r\tend if\r\t\r\treturn\r\t\rend if\r\rset connected_cnt to 0\rset mounted_cnt to 0\rset ejected_cnt to 0\rset toUserMustReconnect_cnt to 0\r\rset volumeListString to \"\"\r\rrepeat with volume in tmDestinationsDiskutilInfo\r\t\r\tset mountedStatus to \"\"\r\t\r\tif volume's connected then\r\t\tset connected_cnt to connected_cnt + 1\r\t\tif volume's status is \"mounted\" then\r\t\t\tset mounted_cnt to mounted_cnt + 1\r\t\telse if volume's status is \"ejected\" then\r\t\t\tset ejected_cnt to ejected_cnt + 1\r\t\telse if volume's status is \"to use, must reconnect\" then\r\t\t\tset toUserMustReconnect_cnt to toUserMustReconnect_cnt + 1\r\t\tend if\r\tend if\r\t\r\tset volumeListString to volumeListString & \"• \" & volume's label & \" (\" & volume's status & \")\" & return\r\t\rend repeat\r\rif (mounted_cnt + ejected_cnt) < 1 then\r\t\r\tset dialogResult to display dialog \"Time Machine volumes:\" & return & return & ¬\r\t\tvolumeListString & return & ¬\r\t\t\"Time Machine is not running and there a no volumes to eject.\" with title myName buttons {\"OK\"} ¬\r\t\tdefault button {\"OK\"}\r\t\r\treturn\r\t\relse\r\t\r\tset end of buttonList to \"Cancel\"\r\t\r\tif mounted_cnt > 0 then\r\t\tset beginning of buttonList to \"Eject Volume\"\r\tend if\r\t\r\t\r\tset mountNote to \"\"\r\t\r\tif (mounted_cnt + ejected_cnt + toUserMustReconnect_cnt) > 0 then\r\t\tset beginning of buttonList to \"Start Time Machine\"\r\t\tif ejected_cnt > 0 then\r\t\t\tset mountNote to return & \"Note: When starting Time Machine, ejected volumes will be automatically mounted.\" & return\r\t\tend if\r\t\t\r\tend if\r\t\r\tset defaultButton to \"Cancel\"\r\t\r\tset dialogResult to display dialog \"Time Machine volumes:\" & return & return & ¬\r\t\tvolumeListString & mountNote ¬\r\t\twith title myName buttons buttonList default button defaultButton\r\t\r\tif button returned of dialogResult is \"Eject Volume\" then\r\t\t\r\t\tset connected_cnt to 0\r\t\tset mounted_cnt to 0\r\t\tset ejected_cnt to 0\r\t\tset toUserMustReconnect_cnt to 0\r\t\t\r\t\tset volumeListString to \"\"\r\t\t\r\t\t-- The state of one or more of the volumes could have potentially have changed,\r\t\t-- thus regenerate tmDestinationsDiskutilInfo (e.g., by the user)\r\t\tset tmDestinationsDiskutilInfo to getTmDestinationsDiskutilInfo(tmDestinationsInfo)\r\t\t\r\t\trepeat with volume in tmDestinationsDiskutilInfo\r\t\t\t\r\t\t\tset mountedStatus to \"\"\r\t\t\t\r\t\t\tif volume's connected then\r\t\t\t\tset connected_cnt to connected_cnt + 1\r\t\t\t\tif volume's status is \"mounted\" then\r\t\t\t\t\tset mounted_cnt to mounted_cnt + 1\r\t\t\t\t\tset theLabel to volume's label\r\t\t\t\t\tset mountedStatus to volume's status\r\t\t\t\t\tset mountedMountPoint to volume's mount_point\r\t\t\t\t\tset mountedId to volume's id\r\t\t\t\t\tset mountedDeviceIndentifier to volume's device_identifier\r\t\t\t\telse if volume's status is \"ejected\" then\r\t\t\t\t\tset ejected_cnt to ejected_cnt + 1\r\t\t\t\telse if volume's status is \"to use, must reconnect\" then\r\t\t\t\t\tset toUserMustReconnect_cnt to toUserMustReconnect_cnt + 1\r\t\t\t\tend if\r\t\t\tend if\r\t\t\t\r\t\t\tif volume's status is not \"unavailable\" then\r\t\t\t\tset volumeListString to volumeListString & volume's label & \" (\" & volume's status & \")\" & return\r\t\t\tend if\r\t\t\t\r\t\tend repeat\r\t\t\r\t\tif mounted_cnt > 1 then\r\t\t\t\r\t\t\tset volumeList to paragraphs of volumeListString\r\t\t\tset volumesString to listToString(volumeList)\r\t\t\tset thePrompt to \"Select a volume to eject:\"\r\t\t\tset selectedVolume to do shell script \"osascript -e 'return choose from list {\" & volumesString & \"} with prompt \\\"\" & thePrompt & \"\\\" default items {\\\"Cancel\\\"} with title \\\"\" & myName & \"\\\"'\"\r\t\t\tif selectedVolume is \"false\" then\r\t\t\t\t\r\t\t\t\treturn \"User Cancelled\"\r\t\t\t\t\r\t\t\telse\r\t\t\t\t\r\t\t\t\tset theLabel to do shell script \"echo \" & quoted form of selectedVolume & \" | awk 'BEGIN{FS=\\\" \\\\\\\\(\\\"}{print $1}'\"\r\t\t\t\t\r\t\t\t\trepeat with volume in tmDestinationsDiskutilInfo\r\t\t\t\t\tif theLabel is equal to volume's label then\r\t\t\t\t\t\tset mountedMountPoint to volume's mount_point\r\t\t\t\t\tend if\r\t\t\t\tend repeat\r\t\t\t\t\r\t\t\tend if\r\t\t\t\r\t\tend if\r\t\t\r\t\ttry\r\t\t\tdo shell script \"diskutil unmountDisk \" & quoted form of mountedMountPoint\r\t\t\tdisplay notification quoted form of theLabel & ¬\r\t\t\t\t\" has been ejected.\" with title myName\r\t\ton error\r\t\t\tdisplay dialog quoted form of theLabel & \" could not be ejected.\" with title myName\r\t\tend try\r\t\t\r\telse if button returned of dialogResult is \"Start Time Machine\" then\r\t\t\r\t\tset connected_cnt to 0\r\t\tset mounted_cnt to 0\r\t\tset ejected_cnt to 0\r\t\tset toUserMustReconnect_cnt to 0\r\t\t\r\t\tset volumeListString to \"\"\r\t\t\r\t\t-- The state of one or more of the volumes could have potentially have changed,\r\t\t-- thus regenerate tmDestinationsDiskutilInfo (e.g., by the user)\r\t\tset tmDestinationsDiskutilInfo to getTmDestinationsDiskutilInfo(tmDestinationsInfo)\r\t\t\r\t\trepeat with volume in tmDestinationsDiskutilInfo\r\t\t\t\r\t\t\tset mountedStatus to \"\"\r\t\t\t\r\t\t\tif volume's connected then\r\t\t\t\tset connected_cnt to connected_cnt + 1\r\t\t\t\tif volume's status is \"mounted\" then\r\t\t\t\t\tset mounted_cnt to mounted_cnt + 1\r\t\t\t\telse if volume's status is \"ejected\" then\r\t\t\t\t\tset ejected_cnt to ejected_cnt + 1\r\t\t\t\telse if volume's status is \"to use, must reconnect\" then\r\t\t\t\t\tset toUserMustReconnect_cnt to toUserMustReconnect_cnt + 1\r\t\t\t\tend if\r\t\t\t\t\r\t\t\t\tif volume's status is \"mounted\" or volume's status is \"ejected\" then\r\t\t\t\t\t\r\t\t\t\t\tset theLabel to volume's label\r\t\t\t\t\tset mountedOrMoutableStatus to volume's status\r\t\t\t\t\tset mountedOrMoutableMountPoint to volume's mount_point\r\t\t\t\t\tset mountedOrMoutableId to volume's id\r\t\t\t\t\tset mountedOrMoutableDeviceIndentifier to volume's device_identifier\r\t\t\t\t\t\r\t\t\t\tend if\r\t\t\t\t\r\t\t\tend if\r\t\t\t\r\t\t\tif volume's status is not \"unavailable\" then\r\t\t\t\tset volumeListString to volumeListString & volume's label & \" (\" & volume's status & \")\" & return\r\t\t\tend if\r\t\t\t\r\t\tend repeat\r\t\t\r\t\tif (mounted_cnt + ejected_cnt) > 1 then\r\t\t\t\r\t\t\tset volumeList to paragraphs of volumeListString\r\t\t\tset volumesString to listToString(volumeList)\r\t\t\tif ejected_cnt > 0 then\r\t\t\t\tset thePrompt to \"Select a Time Machine volume (ejected volumes will be automatically mounted):\"\r\t\t\telse\r\t\t\t\tset thePrompt to \"Select a Time Machine volume:\"\r\t\t\tend if\r\t\t\tset selectedVolume to do shell script \"osascript -e 'return choose from list {\" & volumesString & \"} with prompt \\\"\" & thePrompt & \"\\\" default items {\\\"Cancel\\\"} with title \\\"\" & myName & \"\\\"'\"\r\t\t\t\r\t\t\tif selectedVolume is \"false\" then\r\t\t\t\t\r\t\t\t\treturn \"User Cancelled\"\r\t\t\t\t\r\t\t\telse\r\t\t\t\t\r\t\t\t\tset theLabel to do shell script \"echo \" & quoted form of selectedVolume & \" | awk 'BEGIN{FS=\\\" \\\\\\\\(\\\"}{print $1}'\"\r\t\t\t\t\r\t\t\t\trepeat with volume in tmDestinationsDiskutilInfo\r\t\t\t\t\tif theLabel is equal to volume's label then\r\t\t\t\t\t\tset mountedOrMoutableStatus to volume's status\r\t\t\t\t\t\tset mountedOrMoutableId to volume's id\r\t\t\t\t\t\tset mountedOrMoutableDeviceIndentifier to volume's device_identifier\r\t\t\t\t\tend if\r\t\t\t\tend repeat\r\t\t\t\t\r\t\t\tend if\r\t\t\t\r\t\tend if\r\t\t\r\t\tif mountedOrMoutableStatus is not \"mounted\" then\r\t\t\t\r\t\t\tdo shell script \"diskutil mountDisk \" & quoted form of mountedOrMoutableDeviceIndentifier\r\t\t\t\r\t\tend if\r\t\t\r\t\t-- It's possible that Time Machine automatically started during the period\r\t\t-- that the above dialogs were open. If it automatically started for the volume\r\t\t-- that was selected, let it continue. If it was another volume, stop it before\r\t\t-- starting Time Machine for the selected volume.\r\t\t\r\t\tset tmStatus to getTmStatus(tmDestinationsInfo, tmDestinationsDiskutilInfo)\r\t\t\r\t\tif tmStatus's destination_id is mountedOrMoutableId then\r\t\t\t\r\t\t\tdisplay notification \"Time Machine to \" & quoted form of theLabel & ¬\r\t\t\t\t\" is already running.\" with title myName\r\t\t\t\r\t\telse if tmStatus's backup_phase is not \"\" then\r\t\t\t\r\t\t\tset prevLabel to tmStatus's label\r\t\t\t\r\t\t\tdo shell script \"tmutil stopbackup\"\r\t\t\t\r\t\t\tset timeoutLimit to 10\r\t\t\tset startTime to current date\r\t\t\t\r\t\t\trepeat\r\t\t\t\tset tmStatus to getTmStatus(tmDestinationsInfo, tmDestinationsDiskutilInfo)\r\t\t\t\tif tmStatus's backup_phase is \"\" then\r\t\t\t\t\texit repeat\r\t\t\t\tend if\r\t\t\t\tdelay 1\r\t\t\t\tif ((current date) - startTime) > timeoutLimit then\r\t\t\t\t\tdisplay dialog \"Time Machine to \" & quoted form of prevLabel & ¬\r\t\t\t\t\t\t\" was already running. An attempt to stop it failed after \" & timeoutLimit & ¬\r\t\t\t\t\t\t\" seconds.\" with title myName buttons {\"OK\"} default button {\"OK\"}\r\t\t\t\t\treturn \"Timeout\"\r\t\t\t\tend if\r\t\t\tend repeat\r\t\t\t\r\t\t\tdisplay notification \"Time Machine to \" & quoted form of prevLabel & ¬\r\t\t\t\t\" was running and was stopped.\" with title myName\r\t\t\t\r\t\t\tdelay 2.0\r\t\t\t\r\t\t\tdo shell script \"tmutil startbackup --destination \" & quoted form of mountedOrMoutableId\r\t\t\tdisplay notification \"Time Machine to \" & quoted form of theLabel & ¬\r\t\t\t\t\" started.\" with title myName\r\t\t\t\r\t\telse\r\t\t\t\r\t\t\tdo shell script \"tmutil startbackup --destination \" & quoted form of mountedOrMoutableId\r\t\t\tdisplay notification \"Time Machine to \" & quoted form of theLabel & ¬\r\t\t\t\t\" started.\" with title myName\r\t\t\t\r\t\tend if\r\t\t\r\tend if\r\t\rend if\r\r\r-- == Handlers =================================================\r\ron myName()\r\ttell application \"Finder\"\r\t\tset myPath to (path to me) as alias\r\t\tset myFileName to name of myPath\r\t\tset myName to (text 1 thru ((offset of \".\" in myFileName) - 1) of myFileName)\r\tend tell\r\t\r\t-- return myName\r\treturn \"Time Machine Assistant\"\rend myName\r\ron listToString(theList)\r\t-- Convert the AppleScript list to a string\r\tset str to \"\"\r\trepeat with i from 1 to count of theList\r\t\tset str to str & \"\\\"\" & item i of theList & \"\\\"\" & \", \"\r\tend repeat\r\t-- Remove the trailing comma\r\tset str to text 1 thru -3 of str\r\treturn str\rend listToString\r\r-- Information gathered here, will not change during the execution of this script\ron getTmDestinationsInfo()\r\t\r\tset tmudi_raw to do shell script \"tmutil destinationinfo\"\r\tset tmutilDestinationinfo to do shell script \"echo \" & quoted form of tmudi_raw & \" | sed 's/> ===/=====/g'\"\r\t\r\tset AppleScript's text item delimiters to \"====================================================\"\r\tset theItms to text items of tmutilDestinationinfo\r\t\r\tset tmDestinationsInfo to {}\r\t\r\trepeat with cItm in theItms\r\t\tset AppleScript's text item delimiters to return\r\t\tset cItmLines to text items of cItm\r\t\tset cItmRec to {label:\"\", id:\"\"}\r\t\t\r\t\trepeat with cLine in cItmLines\r\t\t\tif cLine starts with \"Name\" then\r\t\t\t\tset label of cItmRec to do shell script \"echo \" & quoted form of cLine & \" | awk -F': ' '{print $2}'\"\r\t\t\telse if cLine starts with \"ID\" then\r\t\t\t\tset id of cItmRec to do shell script \"echo \" & quoted form of cLine & \" | awk -F': ' '{print $2}'\"\r\t\t\tend if\r\t\tend repeat\r\t\t\r\t\tif label of cItmRec is not \"\" then\r\t\t\tset end of tmDestinationsInfo to cItmRec\r\t\tend if\r\tend repeat\r\t\r\treturn tmDestinationsInfo\r\t\rend getTmDestinationsInfo\r\r-- Information here will update as Time Machine changes\ron getTmDestinationsDiskutilInfo(tmDestinationsInfo)\r\t\r\tset tmDestinationsDiskutilInfo to {}\r\t\r\trepeat with i in tmDestinationsInfo\r\t\t\r\t\tset iRecord to {label:\"\", id:\"\", device_identifier:\"\", mount_point:\"\", encryption:\"\", connected:\"\", status:\"\"}\r\t\t\r\t\tset device_identifier to \"\"\r\t\tset mount_point to \"\"\r\t\tset encryption to \"\"\r\t\tset status to \"\"\r\t\tset connected to true\r\t\t\r\t\ttry\r\t\t\tset du to do shell script \"diskutil info -plist \" & quoted form of i's label\r\t\t\t\r\t\t\tset device_identifier to do shell script \"echo \" & quoted form of du & \" | tr '\\\\015' '\\\\012' | awk -F'<|>' '/<key>DeviceIdentifier<\\\\/key>/{getline; print $3}'\"\r\t\t\tset mount_point to do shell script \"echo \" & quoted form of du & \" | tr '\\\\015' '\\\\012' | awk -F'<|>' '/<key>MountPoint<\\\\/key>/{getline; print $3}'\"\r\t\t\tset encryption to do shell script \"echo \" & quoted form of du & \" | tr '\\\\015' '\\\\012' | awk -F'<|>' '/<key>Encryption<\\\\/key>/{getline; print}'\"\r\t\ton error\r\t\t\tset connected to false\r\t\tend try\r\t\t\r\t\tset label of iRecord to i's label\r\t\tset id of iRecord to i's id\r\t\tset device_identifier of iRecord to device_identifier\r\t\tset mount_point of iRecord to mount_point\r\t\t\r\t\tset encryption to (encryption contains \"true\")\r\t\tset encryption of iRecord to encryption\r\t\t\r\t\tif connected then\r\t\t\tset connected of iRecord to true\r\t\t\tif mount_point is not \"\" then\r\t\t\t\tset status of iRecord to \"mounted\"\r\t\t\telse\r\t\t\t\tif encryption then\r\t\t\t\t\tset status of iRecord to \"to use, must reconnect\"\r\t\t\t\telse\r\t\t\t\t\tset status of iRecord to \"ejected\"\r\t\t\t\tend if\r\t\t\tend if\r\t\telse\r\t\t\tset connected of iRecord to false\r\t\t\tset status of iRecord to \"unavailable\"\r\t\tend if\r\t\t\r\t\tif label of iRecord is not \"\" then\r\t\t\tset end of tmDestinationsDiskutilInfo to iRecord\r\t\tend if\r\t\t\r\tend repeat\r\t\r\treturn tmDestinationsDiskutilInfo\r\t\rend getTmDestinationsDiskutilInfo\r\r-- Information here will update as Time Machine changes\ron getTmStatus(tmDestinationsInfo, tmDestinationsDiskutilInfo)\r\t\r\tset tmStatus to {backup_phase:\"\", destination_id:\"\", label:\"\", mount_point:\"\", destination_identifier:\"\", encryption:\"\"}\r\t\r\tset tms to do shell script \"tmutil status\"\r\t\r\tset backup_phase of tmStatus ¬\r\t\tto do shell script \"echo \" & quoted form of tms & \" | tr '\\\\015' '\\\\012' | grep BackupPhase | awk -F' = ' '{print $2}' | tr -d ';'\"\r\t\r\tset destination_id of tmStatus ¬\r\t\tto do shell script \"echo \" & quoted form of tms & \" | tr '\\\\015' '\\\\012' | grep DestinationID | awk -F' = ' '{print $2}' | tr -d ';' | tr -d '\\\"'\"\r\t\r\trepeat with i in tmDestinationsInfo\r\t\tif i's id is equal to destination_id of tmStatus then\r\t\t\tset label of tmStatus to i's label\r\t\t\texit repeat\r\t\tend if\r\tend repeat\r\t\r\trepeat with i in tmDestinationsDiskutilInfo\r\t\tif i's label is equal to label of tmStatus then\r\t\t\tset mount_point of tmStatus to i's mount_point\r\t\t\tset destination_identifier of tmStatus to i's device_identifier\r\t\t\tset encryption of tmStatus to i's encryption\r\t\t\texit repeat\r\t\tend if\r\tend repeat\r\t\r\treturn tmStatus\r\t\rend getTmStatus",
			"NotifyOnFailure": false
		}
	],
	"Name": "Time Machine Assistant",
	"CustomIconData": "KMEP-GenericApplication-/System/Library/CoreServices/Finder.app"
}